{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\khaym\\\\Desktop\\\\finalproject\\\\Inventory-Front-End\\\\src\\\\state\\\\context\\\\UserContext.jsx\",\n    _s = $RefreshSig$();\n\nimport { createContext, useEffect, useMemo, useState } from 'react';\nimport { getUser, getLocalProfile, saveLocalProfile, removeLocalProfile, getProfile, onAuthChange } from '../services/user-service.js';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const UserStateContext = /*#__PURE__*/createContext();\nexport const UserActionContext = /*#__PURE__*/createContext();\nexport default function UserProvider(_ref) {\n  _s();\n\n  let {\n    children\n  } = _ref;\n  const [user, setUser] = useState(getUser());\n  const [profile, setProfile] = useState(getLocalProfile());\n\n  const loadProfile = async () => {\n    const {\n      data,\n      error\n    } = await getProfile();\n\n    if (error) {\n      // no row returned\n      if (error.code === 'PGRST116') {\n        setProfile(null);\n        removeLocalProfile();\n      } // unknown error...\n      // eslint-disable-next-line no-console\n      else console.log(error);\n    }\n\n    if (data) {\n      setProfile(data);\n      saveLocalProfile(data);\n    }\n  };\n\n  useEffect(() => {\n    if (user) loadProfile();\n    const {\n      data\n    } = onAuthChange(event => {\n      if (event == 'SIGNED_IN') loadProfile();\n\n      if (event == 'SIGNED_OUT') {\n        setUser(null);\n        setProfile(null);\n        removeLocalProfile();\n      }\n    });\n    return () => {\n      data.unsubscribe();\n    };\n  }, []);\n  const stateValue = {\n    user,\n    profile\n  };\n  const actionValue = useMemo(() => ({\n    setUser,\n    setProfile\n  }), [setUser, setProfile]);\n  return /*#__PURE__*/_jsxDEV(UserStateContext.Provider, {\n    value: stateValue,\n    children: /*#__PURE__*/_jsxDEV(UserActionContext.Provider, {\n      value: actionValue,\n      children: children\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 67,\n    columnNumber: 5\n  }, this);\n}\n\n_s(UserProvider, \"aNncC9qJQlbDTpXX/TvIRMZAShQ=\");\n\n_c = UserProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"UserProvider\");","map":{"version":3,"names":["createContext","useEffect","useMemo","useState","getUser","getLocalProfile","saveLocalProfile","removeLocalProfile","getProfile","onAuthChange","UserStateContext","UserActionContext","UserProvider","children","user","setUser","profile","setProfile","loadProfile","data","error","code","console","log","event","unsubscribe","stateValue","actionValue"],"sources":["C:/Users/khaym/Desktop/finalproject/Inventory-Front-End/src/state/context/UserContext.jsx"],"sourcesContent":["import { createContext, useEffect, useMemo, useState } from 'react';\r\nimport {\r\n  getUser,\r\n  getLocalProfile,\r\n  saveLocalProfile,\r\n  removeLocalProfile,\r\n  getProfile,\r\n  onAuthChange,\r\n} from '../services/user-service.js';\r\n\r\nexport const UserStateContext = createContext();\r\nexport const UserActionContext = createContext();\r\n\r\nexport default function UserProvider({ children }) {\r\n  const [user, setUser] = useState(getUser());\r\n  const [profile, setProfile] = useState(getLocalProfile());\r\n\r\n  const loadProfile = async () => {\r\n    const { data, error } = await getProfile();\r\n\r\n    if (error) {\r\n      // no row returned\r\n      if (error.code === 'PGRST116') {\r\n        setProfile(null);\r\n        removeLocalProfile();\r\n      }\r\n      // unknown error...\r\n      // eslint-disable-next-line no-console\r\n      else console.log(error);\r\n    }\r\n    if (data) {\r\n      setProfile(data);\r\n      saveLocalProfile(data);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (user) loadProfile();\r\n\r\n    const { data } = onAuthChange((event) => {\r\n      if (event == 'SIGNED_IN') loadProfile();\r\n      if (event == 'SIGNED_OUT') {\r\n        setUser(null);\r\n        setProfile(null);\r\n        removeLocalProfile();\r\n      }\r\n    });\r\n    return () => {\r\n      data.unsubscribe();\r\n    };\r\n  }, []);\r\n\r\n  const stateValue = {\r\n    user,\r\n    profile,\r\n  };\r\n\r\n  const actionValue = useMemo(\r\n    () => ({\r\n      setUser,\r\n      setProfile,\r\n    }),\r\n    [setUser, setProfile]\r\n  );\r\n\r\n  return (\r\n    <UserStateContext.Provider value={stateValue}>\r\n      <UserActionContext.Provider value={actionValue}>\r\n        {children}\r\n      </UserActionContext.Provider>\r\n    </UserStateContext.Provider>\r\n  );\r\n}\r\n"],"mappings":";;;AAAA,SAASA,aAAT,EAAwBC,SAAxB,EAAmCC,OAAnC,EAA4CC,QAA5C,QAA4D,OAA5D;AACA,SACEC,OADF,EAEEC,eAFF,EAGEC,gBAHF,EAIEC,kBAJF,EAKEC,UALF,EAMEC,YANF,QAOO,6BAPP;;AASA,OAAO,MAAMC,gBAAgB,gBAAGV,aAAa,EAAtC;AACP,OAAO,MAAMW,iBAAiB,gBAAGX,aAAa,EAAvC;AAEP,eAAe,SAASY,YAAT,OAAoC;EAAA;;EAAA,IAAd;IAAEC;EAAF,CAAc;EACjD,MAAM,CAACC,IAAD,EAAOC,OAAP,IAAkBZ,QAAQ,CAACC,OAAO,EAAR,CAAhC;EACA,MAAM,CAACY,OAAD,EAAUC,UAAV,IAAwBd,QAAQ,CAACE,eAAe,EAAhB,CAAtC;;EAEA,MAAMa,WAAW,GAAG,YAAY;IAC9B,MAAM;MAAEC,IAAF;MAAQC;IAAR,IAAkB,MAAMZ,UAAU,EAAxC;;IAEA,IAAIY,KAAJ,EAAW;MACT;MACA,IAAIA,KAAK,CAACC,IAAN,KAAe,UAAnB,EAA+B;QAC7BJ,UAAU,CAAC,IAAD,CAAV;QACAV,kBAAkB;MACnB,CAHD,CAIA;MACA;MALA,KAMKe,OAAO,CAACC,GAAR,CAAYH,KAAZ;IACN;;IACD,IAAID,IAAJ,EAAU;MACRF,UAAU,CAACE,IAAD,CAAV;MACAb,gBAAgB,CAACa,IAAD,CAAhB;IACD;EACF,CAjBD;;EAmBAlB,SAAS,CAAC,MAAM;IACd,IAAIa,IAAJ,EAAUI,WAAW;IAErB,MAAM;MAAEC;IAAF,IAAWV,YAAY,CAAEe,KAAD,IAAW;MACvC,IAAIA,KAAK,IAAI,WAAb,EAA0BN,WAAW;;MACrC,IAAIM,KAAK,IAAI,YAAb,EAA2B;QACzBT,OAAO,CAAC,IAAD,CAAP;QACAE,UAAU,CAAC,IAAD,CAAV;QACAV,kBAAkB;MACnB;IACF,CAP4B,CAA7B;IAQA,OAAO,MAAM;MACXY,IAAI,CAACM,WAAL;IACD,CAFD;EAGD,CAdQ,EAcN,EAdM,CAAT;EAgBA,MAAMC,UAAU,GAAG;IACjBZ,IADiB;IAEjBE;EAFiB,CAAnB;EAKA,MAAMW,WAAW,GAAGzB,OAAO,CACzB,OAAO;IACLa,OADK;IAELE;EAFK,CAAP,CADyB,EAKzB,CAACF,OAAD,EAAUE,UAAV,CALyB,CAA3B;EAQA,oBACE,QAAC,gBAAD,CAAkB,QAAlB;IAA2B,KAAK,EAAES,UAAlC;IAAA,uBACE,QAAC,iBAAD,CAAmB,QAAnB;MAA4B,KAAK,EAAEC,WAAnC;MAAA,UACGd;IADH;MAAA;MAAA;MAAA;IAAA;EADF;IAAA;IAAA;IAAA;EAAA,QADF;AAOD;;GA3DuBD,Y;;KAAAA,Y"},"metadata":{},"sourceType":"module"}